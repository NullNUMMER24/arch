---
- name: Configure Arch
  hosts: localhost
  become: yes
  tasks:
    - name: Include Variables
      include_vars:
        file: vars/sysvars.yml

#################################################################################
# Update system and mirrors and install yay
#################################################################################
    - name: Update system and mirrors
      community.general.pacman:
        update_cache: true
        upgrade: true
      when: update

    - name: Install yay
      community.general.pacman:
        name: yay
        state: present

#################################################################################
# i3
#################################################################################
    - name: Include i3 tasks
      ansible.builtin.include_tasks:
        file: tasks/i3.yml
      when: i3

    - name: Install flameshot
      community.general.pacman:
        name: flameshot
        state: present

    - name: Install blueman
      community.general.pacman:
        name: blueman
        state: present

#################################################################################
# Terminal/Shell
#################################################################################
    - name: Include Alacritty tasks
      ansible.builtin.include_tasks:
        file: tasks/alacritty.yml
      when: alacritty

    - name: Include zsh tasks
      ansible.builtin.include_tasks:
        file: tasks/ohmyzsh.yml
      when: zsh
      
    - name: Include fonts tasks
      ansible.builtin.include_tasks:
        file: tasks/fonts.yml
      when: fonts

    - name: Include Neovim tasks
      ansible.builtin.include_tasks:
        file: tasks/neovim.yml
      when: neovim

    - name: Include vscode tasks
      ansible.builtin.include_tasks:
        file: tasks/vscode.yml
      when: vscode

#################################################################################
# Notes
#################################################################################
    - name: Include obsidian task
      ansible.builtin.include_tasks:
        file: tasks/obsidian.yml
      when: obsidian

#################################################################################
# Thunderbird
#################################################################################
    - name: install Thunderbird
      community.general.pacman:
        name: thunderbird
        state: present
      when: mail

#################################################################################
# Remote Connection
#################################################################################
    - name: install Remmina (RDP)
      community.general.pacman:
        name: remmina
        state: present
      when: remmina

#################################################################################
# Applications
#################################################################################
    - name: install Chromium
      community.general.pacman:
        name: chromium
        state: present

    - name: Include Spotify task
      ansible.builtin.include_tasks:
        file: tasks/spotify.yml

    - name: Include Discord task
      ansible.builtin.include_tasks:
        file: tasks/discord.yml

    - name: Include Minecraft task
      ansible.builtin.include_tasks:
        file: tasks/minecraft.yml
      when: minecraft

    - name: Include Steam task
      ansible.builtin.include_tasks:
        file: tasks/steam.yml
      when: steam

#################################################################################
# Yubikey
#################################################################################
    - name: Include Yubkey task
      ansible.builtin.include_tasks:
        file: tasks/yubikey.yml
      when: minecraft


#################################################################################
# Monitor
#################################################################################
    - name: install Arandr and Autorandr
      community.general.pacman:
        name:
        - arandr
        - autorandr
        state: present

#################################################################################
# Storage
#################################################################################
    - name: install nextcloud-client
      community.general.pacman:
        name: nextcloud-client
        state: present

#################################################################################
# Virt-Manager
#################################################################################
    - name: Install KVM packages
      community.general.pacman:
        name:
        - qemu
        - virt-manager
        - virt-viewer
        - dnsmasq
        - vde2
        - bridge-utils
        - openbsd-netcat
        - dmidecode
        state: present
      when: vm

    - name: Install libguestfs
      community.general.pacman:
        name:
        - libguestfs
        state: present
      when: vm

    - name: enable libvirt service
      ansible.builtin.service:
        name: libvirtd.service
        state: started
        enabled: yes
      when: vm
